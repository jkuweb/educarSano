---
import Layout from "@/layouts/Layout.astro";
import { getCategoryPageData } from "@/lib/getCategoryPageData";
import { getAllCategories } from "@/lib/getAllCategories";
import PaginationStatic from "@/components/Pagination/PaginationStatic.astro";
import PostCard from "@/components/PostCard/PostCard.astro";
export const prerender = false;
export async function getStaticPaths() {
    const categories = await getAllCategories();
    const paths = [];
    for (const cat of categories) {
        if (!cat.slug) continue;
        const { totalPages } = await getCategoryPageData(cat.slug, 1);
        for (let i = 2; i <= totalPages; i++) {
            paths.push({
                params: { slug: cat.slug, page: String(i) },
            });
        }
    }
    return paths;
}
const { slug, page } = Astro.params;
const currentPage = Number(page);
const { posts, totalPages } = await getCategoryPageData(slug!, currentPage);
---

<Layout title={`Categoría: ${slug} - Página ${currentPage}`} isHome={false}>
    <section class="pt-24 pb-24 px-4 bg-[#E1E7EF]">
        <h1 class="text-3xl font-bold mb-6">
            Categoría: {slug} (Página {currentPage})
        </h1>
        {
            posts.length === 0 ? (
                <p class="text-gray-500">No hay posts en esta categoría.</p>
            ) : (
                <ul class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
                    {posts.map((post, index) => (
                        <li class="bg-white rounded-lg shadow hover:shadow-lg transition">
                            <PostCard
                                post={post}
                                index={index}
                                hasCategories={true}
                                hasTags={true}
                            />
                        </li>
                    ))}
                </ul>
            )
        }
        <PaginationStatic
            basePath={`blog/category/${slug}`}
            currentPage={currentPage}
            totalPages={totalPages}
        />
    </section>
</Layout>
