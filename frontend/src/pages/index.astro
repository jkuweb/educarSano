---
export const prerender = true;
import Layout from "@/layouts/Layout.astro";
import RenderBlocks from "@/blocks/RenderBlocks.astro";
import Hero from "@/globals/Hero.astro";

const PAYLOAD_API = import.meta.env.PAYLOAD_URL;

let home = null;

if (PAYLOAD_API) {
    try {
        const response = await fetch(`${PAYLOAD_API}/api/pages/1?depth=2`);
        if (response.ok) {
            home = await response.json();
        } else {
            console.warn(`Payload API returned ${response.status} for home page`);
        }
    } catch (err) {
        console.warn("Payload fetch failed during build:", err);
    }
} else {
    console.warn("PAYLOAD_URL not set â€” skipping build-time fetch for home page");
}

if (!home) {
    return Astro.redirect("/404");
}

const isHome = Astro.url.pathname === "/";
---

<Layout meta={home.meta} isHome={isHome}>
    <Hero {...home.hero} />
    <RenderBlocks blocks={home.layout} />
</Layout>
