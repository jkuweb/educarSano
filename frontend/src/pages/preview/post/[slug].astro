---
import Layout from "@/layouts/Layout.astro";
import { getPostBySlug } from "@/lib/getPostBySlug";

const { slug } = Astro.params;

const post = await getPostBySlug(slug!, { depth: 2, draft: true });

if (!post) {
    return Astro.redirect("/404");
}

Astro.response.headers.set(
    "Cache-Control",
    "no-store, no-cache, must-revalidate",
);
Astro.response.headers.set("Pragma", "no-cache");
Astro.response.headers.set("Expires", "0");
---

<Layout>
    <div
        style="background: #ff6b35; color: white; padding: 1rem; text-align: center; position: sticky; top: 0; z-index: 9999;"
    >
        üîç Modo Preview - Viendo borrador
        <a
            href={`/blog/${slug}`}
            style="color: white; margin-left: 1rem; text-decoration: underline; font-weight: bold;"
        >
            Ver publicada
        </a>
    </div>

    <article class="max-w-3xl mx-auto px-4 py-12 prose">
        <h1 class="text-4xl font-bold mb-4">{post.title}</h1>
        <div set:html={post.content} />
    </article>
</Layout>
