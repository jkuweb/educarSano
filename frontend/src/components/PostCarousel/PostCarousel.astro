---
import type { Post } from "@/lib/payloadTypes";

interface Props {
    posts: Post[];
}

const { posts } = Astro.props;
---

<section class="relative w-full overflow-hidden py-10 bg-white">
    <h2 class="text-2xl font-bold mb-6 text-center">ðŸŒ€ Ãšltimos Posts</h2>

    <!-- Carrusel -->
    <div id="carousel" class="flex gap-6 overflow-hidden px-4 relative">
        {
            posts.map((post) => (
                <article class="min-w-[300px] flex-shrink-0 bg-gray-100 rounded-2xl shadow hover:shadow-lg transition-transform duration-300 p-4 cursor-pointer">
                    <a href={`/blog/post/${post.slug}`} class="block">
                        {post.image && (
                            <img
                                src={post.image.url}
                                alt={post.title}
                                class="rounded-xl w-full h-48 object-cover mb-4"
                                loading="lazy"
                            />
                        )}
                        <h3 class="text-lg font-semibold mb-2 line-clamp-2">
                            {post.title}
                        </h3>
                        <p class="text-gray-600 text-sm line-clamp-3">
                            {post.meta?.description}
                        </p>
                    </a>
                </article>
            ))
        }
    </div>

    <!-- Botones -->
    <button
        id="prevBtn"
        class="absolute left-4 top-1/2 -translate-y-1/2 bg-white shadow rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-100"
    >
        â€¹
    </button>
    <button
        id="nextBtn"
        class="absolute right-4 top-1/2 -translate-y-1/2 bg-white shadow rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-100"
    >
        â€º
    </button>

    <!-- GSAP script -->
    <script>
        import gsap from "gsap";

        const carousel = document.querySelector("#carousel");
        const slides = Array.from(carousel.children);
        const prev = document.querySelector("#prevBtn");
        const next = document.querySelector("#nextBtn");

        let index = 0;
        const visibleCards = 3; // NÃºmero visible en escritorio
        const total = slides.length;
        const slideWidth = slides[0].offsetWidth + 24; // card width + gap
        let isAnimating = false;

        function goToSlide(newIndex) {
            if (isAnimating) return;
            isAnimating = true;
            index = (newIndex + total) % total;

            gsap.to(carousel, {
                x: -index * slideWidth,
                duration: 0.8,
                ease: "power2.out",
                onComplete: () => (isAnimating = false),
            });
        }

        prev.addEventListener("click", () => goToSlide(index - 1));
        next.addEventListener("click", () => goToSlide(index + 1));

        // Autoplay
        let autoplay = setInterval(() => goToSlide(index + 1), 4000);

        carousel.addEventListener("mouseenter", () => clearInterval(autoplay));
        carousel.addEventListener("mouseleave", () => {
            autoplay = setInterval(() => goToSlide(index + 1), 4000);
        });

        // Reset posiciÃ³n al cambiar de tamaÃ±o
        window.addEventListener("resize", () => {
            gsap.set(carousel, { x: -index * (slides[0].offsetWidth + 24) });
        });
    </script>
</section>
